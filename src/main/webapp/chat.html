<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Chat Online</title>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="criptojs/rollups/aes.js" type="text/javascript"></script>
        <script src="criptojs/components/mode-ecb-min.js" type="text/javascript"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
        <!-- Tempusdominus Bootstrap 4 -->
        <link rel="stylesheet" href="plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
        <!-- iCheck -->
        <link rel="stylesheet" href="plugins/icheck-bootstrap/icheck-bootstrap.min.css">
        <!-- JQVMap -->
        <link rel="stylesheet" href="plugins/jqvmap/jqvmap.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="dist/css/adminlte.min.css">
        <!-- overlayScrollbars -->
        <link rel="stylesheet" href="plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
        <!-- Daterange picker -->
        <link rel="stylesheet" href="plugins/daterangepicker/daterangepicker.css">
        <!-- summernote -->
        <link rel="stylesheet" href="plugins/summernote/summernote-bs4.min.css">
        <style>
            body, html {
                height: 100%;
                margin: 0;
            }
            .wrapper {
                min-height: 100%;
                display: flex;
                flex-direction: column;
            }
            .content-wrapper {
                flex: 1;
            }
        </style>
    </head>
    <body class="hold-transition sidebar-mini layout-fixed">
        <aside class="main-sidebar sidebar-dark-primary">
            <!-- GAAAA -->
            <a href="index.html" class="brand-link">
                <img src="dist/img/bebe.jpg" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="width: 35px; height: 35px;">
                <span class="brand-text font-weight-light">CHATS</span>
            </a>
            <div class="wrapper">
                <nav id="sidebar" class="sidebar">
                    <div class="form-inline">
                        <div class="input-group" data-widget="sidebar-search">
                            <input class="form-control form-control-sidebar" type="search" placeholder="Busca un chat" aria-label="Search">
                            <div class="input-group-append">
                                <button class="btn btn-sidebar">
                                    <i class="fas fa-search fa-fw"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                        <div class="image">
                            <img src="img/user3-128x128.jpg" class="img-circle elevation-2" alt="User Image" style="width: 35px; height: 35px;">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">Sarah Bullock</a>
                        </div>
                    </div>
                    <div class="user-panel mt-2 pb-2 mb-2 d-flex">
                        <div class="image">
                            <img src="img/0x0.jpg" class="img-circle elevation-2" alt="User Image" style="width: 35px; height: 35px;">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">
                                <p>
                                    Larry Ellison
                                    <span class="right badge badge-danger">5</span>
                                </p>
                            </a>
                        </div>
                    </div>
                    <div class="user-panel mt-2 pb-2 mb-2 d-flex">
                        <div class="image">
                            <img src="img/1605619247378.jpg" class="img-circle elevation-2" alt="User Image" style="width: 35px; height: 35px;">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">

                                <p>
                                    Michael Bloomberg
                                    <span class="badge badge-info right">3</span>
                                </p>
                            </a>
                        </div>
                    </div>
                    <div class="user-panel mt-2 pb-2 mb-2 d-flex">
                        <div class="image">
                            <img src="img/bill.jpg" class="img-circle elevation-2" alt="User Image" style="width: 35px; height: 35px;">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">

                                <p>
                                    Bill Gates
                                    <span class="badge badge-danger right">8</span>
                                </p>
                            </a>
                        </div>
                    </div>
                    <div class="user-panel mt-2 pb-2 mb-2 d-flex">
                        <div class="image">
                            <img src="img/000.jpg" class="img-circle elevation-2" alt="User Image" style="width: 35px; height: 35px;">
                        </div>
                        <div class="info">
                            <a href="#" class="d-block">

                                <p>
                                    Warren Buffett
                                    <span class="badge badge-info right">2</span>
                                </p>
                            </a>
                        </div>
                    </div>
                    <nav class="mt-2">
                        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                            <li class="nav-header">OPCIONES</li>
                            <li class="nav-item">
                                <a href="principal.html" class="nav-link">
                                    <i class="nav-icon far fa-circle text-info"></i>
                                    <p class="text">INICIO</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="index.html" class="nav-link">
                                    <i class="nav-icon far fa-circle text-danger"></i>
                                    <p class="text">SALIR</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="nav-icon far fa-circle text-warning"></i>
                                    <p class="text">
                                        <i class="fas fa-angle-left right"></i>
                                        <span class="badge badge-info right">2</span>
                                        TEMA</p>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </nav>
            </div>
            <!-- GAAAA -->
        </aside>
        <div class="wrapper">
            <div class="content-wrapper">
                <div class="container-fluid">
                    <div class="row">
                        <section class="col-lg-7 connectedSortable">
                            <!-- DIRECT CHAT -->
                            <div class="card direct-chat direct-chat-primary sidebar-dark-primary" style="width: 174%; height: 102%; margin: 0;">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h3 class="card-title text-white" style="margin-right: 10px;">Usuario:</h3>
                                    <div class="input-group" style="width: 200px; margin-right: 510px;">
                                        <input type="text" id="usuarioinput" name="message" placeholder="Escribe un Nombre" class="form-control">
                                    </div>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-success btn-sm" onclick="openSocket();">
                                            <i class="fa fa-plus text-white"> Abrir</i>	
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm" onclick="closeSocket();">
                                            <i class="fa fa-times text-white"> Cerrar</i>
                                        </button>
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                            <i class="fas fa-search fa-fw" onclick="searchPage();"></i>
                                        </button>
                                        <button type="button" class="btn btn-tool" title="Contacts" data-widget="chat-pane-toggle">
                                            <i class="fas fa-comments"></i>
                                        </button>
                                        <a class="btn btn-tool" id="fullscreen-btn" data-widget="fullscreen" href="#" role="button">
                                            <i class="fas fa-expand-arrows-alt"></i>
                                        </a>
                                    </div>
                                    <script type="text/javascript">
                                        document.getElementById('fullscreen-btn').addEventListener('click', function () {
                                            toggleFullScreen();
                                        });

                                        function toggleFullScreen() {
                                            var elem = document.documentElement;

                                            if (!document.fullscreenElement && !document.mozFullScreenElement &&
                                                    !document.webkitFullscreenElement && !document.msFullscreenElement) {
                                                if (elem.requestFullscreen) {
                                                    elem.requestFullscreen();
                                                } else if (elem.mozRequestFullScreen) {
                                                    elem.mozRequestFullScreen();
                                                } else if (elem.webkitRequestFullscreen) {
                                                    elem.webkitRequestFullscreen();
                                                } else if (elem.msRequestFullscreen) {
                                                    elem.msRequestFullscreen();
                                                }
                                            } else {
                                                if (document.exitFullscreen) {
                                                    document.exitFullscreen();
                                                } else if (document.mozCancelFullScreen) {
                                                    document.mozCancelFullScreen();
                                                } else if (document.webkitExitFullscreen) {
                                                    document.webkitExitFullscreen();
                                                } else if (document.msExitFullscreen) {
                                                    document.msExitFullscreen();
                                                }
                                            }
                                        }
                                    </script>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body" style="width: 100%; height: 100%; padding: 0;">
                                    <!-- Conversations are loaded here -->
                                    <div class="direct-chat-messages" style="width: 100%; height: 100%;">
                                        <!-- Message. Default to the left -->
                                        <div class="direct-chat-msg">
                                            <div class="direct-chat-infos clearfix">
                                                <span class="direct-chat-name float-left text-white">Carlos</span>
                                                <span class="direct-chat-timestamp float-right">16 Nov 2:00 pm</span>
                                            </div>
                                            <!-- /.direct-chat-infos -->
                                            <img class="direct-chat-img" src="dist/img/bebe.jpg" alt="message user image">
                                            <!-- /.direct-chat-img -->
                                            <div data-widget="sidebar-search" class="direct-chat-text">
                                                <input class="form-control form-control-sidebar" id="messageinput" type="text" placeholder="Escribe un mensaje" 
                                                       aria-label="Escribir mensaje">
                                            </div>
                                        </div>
                                        <!-- /.direct-chat-msg -->
                                        <!-- Message to the right -->
                                        <div class="direct-chat-msg right">
                                            <div class="direct-chat-infos clearfix">
                                                <span class="direct-chat-name float-right text-white">Sarah Bullock</span>
                                                <span class="direct-chat-timestamp float-left">16 Nov  2:05 pm</span>
                                            </div>
                                            <!-- /.direct-chat-infos -->
                                            <img class="direct-chat-img" src="img/user3-128x128.jpg" alt="message user image">
                                            <!-- /.direct-chat-img -->
                                            <div class="direct-chat-text" data-widget="sidebar-search">
                                                <input class="form-control form-control-sidebar" id="fechainput" type="text" placeholder="Escribe la Fecha" 
                                                       aria-label="Escribe la Fecha">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer mt-n2">
                                    <form action="#" method="post">
                                        <div class="d-flex justify-content-center">
                                            <button type="button" class="btn btn-info btn-lg w-100" onclick="send();">Enviar Informacion</button>
                                        </div>
                                    </form>
                                </div>
                        </section>
                    </div>
                    <!-- ... otra seccion ... -->     
                    <div class="row mt-2">
                        <section class="col-lg-7 connectedSortable">
                            <!-- Otra ventana -->
                            <div class="card direct-chat direct-chat-primary sidebar-dark-primary" style="width: 174%; height: 47vh; margin: 0;">
                                <div class="card-header d-flex justify-content-start align-items-start">
                                    <!-- Mover el texto a la izquierda y arriba -->
                                    <h4 class="card-title text-white">Información encriptada</h4>
                                </div>
                                <div class="card-body" style="margin: 10px 20px 20px 20px;">
                                    <div class="input-group" style="width: 100%; height: 30vh; margin-bottom: 10px;">
                                        <!-- Cambiar el input a un textarea para varias líneas -->
                                        <textarea style="width: 100%; height: 100%; resize: none;" id="otroInput" name="message" placeholder="Mensajes encriptados...." class="form-control"></textarea>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        <div id="mensaje-a1"></div>
        <div id="messages"></div>
        <script type="text/javascript">
            var webSocket;
            var messages = document.getElementById("messages");
            function openSocket() {
                if (webSocket !== undefined && webSocket.readyState
                        !== WebSocket.CLOSED) {
                    var mensaje = "WebSocket ya está abierto";
                    var divMensaje = document.getElementById("mensaje-a1");
                    divMensaje.innerHTML = mensaje;
                    return;
                }
                var appPath = document.location.pathname.split('/').slice(0, -1).join('/');
                webSocket = new WebSocket("ws://" + document.location.host + appPath + "/proceso");
                webSocket.onopen = function (event) {
                    if (event.data === undefined)
                        return;
                    writeResponse(event.data);
                };
                webSocket.onmessage = function (event) {
                    let o = JSON.parse(event.data);
                    writeResponse("USUARIO: " + o.usuario);
                    writeResponse("MENSAJE: " + o.text);
                    writeResponse("FECHA: " + o.fecha);
                    //writeResponse("NIVEL: " + o.nivel);
                    writeResponse("-----------------------");
                };
                webSocket.onclose = function (event)
                {
                    var mensaje = "Conexion cerrada";
                    var divMensaje = document.getElementById("mensaje-a1");
                    divMensaje.innerHTML = mensaje;
                };
            }

            function send()
            {
                try {
                    let usuario = document.getElementById("usuarioinput").value;
                    let text = document.getElementById("messageinput").value;
                    let fecha = document.getElementById("fechainput").value;
                    let usuarioCif = cifrar(usuario, "1234");
                    let textCif = cifrar(text, "1234");
                    let fechaCif = cifrar(fecha, "1234");
                    let mensaje = {usuario: usuarioCif, text: textCif, fecha: fechaCif};
                    let mensajeJSON = JSON.stringify(mensaje);
                    webSocket.send(mensajeJSON);
                    document.getElementById("messageinput").value = "";
                } catch (err) {
                }
            }
            function closeSocket() {
                try {
                    webSocket.close();
                } catch (err) {
                }
            }
            function writeResponse(text) {
                otroInput.value += text + "\n";
            }
            function cifrar(message, key) {
                var keyHex = CryptoJS.enc.Utf8.parse(key);
                var encrypted = CryptoJS.AES.encrypt(message, keyHex, {//se difra usando des
                    mode: CryptoJS.mode.ECB, //se espezifika el modo
                    padding: CryptoJS.pad.Pkcs7//y el resheno, el 5 tiene definido 8 bits, y el 7 tambien, pero puede ser modificado a mas, pero si no le pones ningun parametro, trabajara con 5
                });
                return encrypted.toString();
            }
        </script>
    </body>
   

</html>